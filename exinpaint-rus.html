<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="ru">
<head>
  <meta http-equiv="Content-Language" content="ru">
  <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>ExInpaint</title>
<link rel="stylesheet" type="text/css" href="../avisynth.css">

</head>
<body>
<h1>ExInpaint</h1>
<h2>Общая информация</h2>
<b>автор:</b> Alexander Balakhnin ('Fizick')
<br><b>версия:</b> 0.2
<br><b>скачивание:</b> <a href="http://avisynth.org.ru/">http://avisynth.org.ru/</a> <br>
<b>категория:</b>  Масочные операции <br>
<b>требования:</b> RGB24, RGB32, YV12, YUY2 цветовой формат<br>
<hr>

<p>Подрисовывание изображений образцами  (Exemplar-Based Image Inpainting) - удаление больших объектов с изображений.</p>
<p>Выбранные объекты будут заменяться визуально правдоподобным фоном,
который имитирует вид соседних областей исходника.
В отличие от других средств подрисовки (заполнения, удаления логотипов), данный фильтр не размывает "дыры" на изображении. 
Он пытается заменить дыры некими подобными текстурными элементами (заплатами, образцами, блоками) из области изображения кадра,
беря в расчет специальные точки изображения (с оцененной достоверностью и приоритетом).
Блочное подрисовывание начинается на границе дыры и распространяется к его внутренней области, по изофоте в качестве направления. 
</p>
<p>Алгоритм основан на статье: Object Removal by Exemplar-Based Inpainting.
A. Criminisi, P. Perez, K. Toyama. In Proc. Conf. Comp. Vision Pattern Rec., Madison, WI, Jun 2003.
http://research.microsoft.com/vision/cambridge/papers/Criminisi_cvpr03.pdf
</p>

<h2>Синтакс и параметры</h2>
<p><code>ExInpaint</code> (<var>clip, clip "mask", int "color", int "dilate", int "xsize", int "ysize", int "radius", int "steps")</var></p>
<p>самый первый параметр - исходный клип. Если клип маски опущен и исходный клип имеет формат RGB32,
 тогда его альфа-канал используется как маска с порогом = 127 
 (все пикселы с соответствующей alpha= 128-255 будут подрисованы). 
 В других случаях, маска берется из клипа mask и обрабатывается иначе.
</p>
<p><var>mask</var> : клип с маской. Должен быть того же формата и размера как исходный клип.
</p>
<p><var>color</var> : цвет маски в клипе mask (если используется). 
Пикселы с ТОЛЬКО с данным цветом будут рассматриваться как маска. (по умолчанию = $FFFFFF как чисто белый для RGB).
Замечание: для YUV цветового пространства, величина color - в YUV (подобно color_yuv в фильтре ColorYUV).
</p>
<p><var>dilate</var> : (экспериментальный) признак расширения маски. 
0 - не расширять, 1 - расширять по горизонтали, 2 - расширять по вертикали, 3 - расширять по обоим направлениям. По умолчанию=0. 
</p>
<p><var>xsize, ysize</var> : горизонтальный и вертикальный размер заплаты (блока) поиска и подрисовки.
Заплата должна быть несколько больше чем наибольший различимый текстурный элемент. 
(По умолчанию =8)
</p>
<p><var>radius</var> : радиус поиска подобного блока. Должен быть больше чем удвоенный размер заплаты 
и больше чем максимальный радиус дырки. Чем больше, тем медленнее. Установите в 0 для автоматического оценивания величины (по умолчанию)
</p>
<p><var>steps</var> : ограничивает число шагов порисовки для отладки (по умолчанию=100000, практически 
неограниченно).
</p>

<h2>Особенности и ограничения</h2>
<p>Медленный, не оптимизирован, особенно для большого радиуса.</p>
<p>Это пространственный фильтр разработанный для статических изображений. Использует только текущий кадр. 
Таким образом, мы можем видеть временную нестабильность в данной версии.</p>
<p>Потенциально он может быть использован для удаления логотипов, реставрации фильмов (удаления пятеп и царапин), 
и заполнения пустых или поврежденных областей после захвата ВХС или компенсации движения.</p>
<p>Он может быть реализован по-другому, может быть как часть MVTools. Текущая версия - главным образом для тестирования.</p>
<p>Для удаления логотипов и подобных задач вы также можете попробовать фильтры подрисовки XLogo, AVSInpaint, Greycstoration.</p>

<h2>Примеры</h2>
<h4>Подрисовка поврежденных или увеличенных бордюров</h4>
<p>Окантованный кайдр с синей маской на границах (конечно мы можем маскировать не только границы):</p>
<img src="masked.jpg" alt="masked" width="352" height="240">
<p>Подрисованный кажр, который был восстановлен из маскированного кадра (приятные текстуры цветов, дерева и дома):</p>
<img src="inpainted.jpg" alt="inpainted" width="352" height="240">
<p>Оригинальный кадр для сравнения (некоторые скрытые детали конечно отличаются):</p>
<img src="original.jpg" alt="original" width="352" height="240">
<p>Использованный скрипт для данного примера:
<pre>loadplugin("exinpaint.dll")
AVISource("G:\flower\sflowg.avi")
converttorgb
i=last
c=letterbox(16,16,16,16,color=$0000ff) # синяя маска mask
# (по некоторой причине синий есть $0000FE в JPG изображении)
exinpaint(c,c,color=$0000ff) # испльзуем исходный клип как маску
interleave(c,last,i)
</pre>
</p>

<h2>Обсуждение</h2>
<p><a href="http://forum.doom9.org/showthread.php?t=133773">
http://forum.doom9.org/showthread.php?t=133773</a></p>

<h2>Ревизии</h2>

<p>Версия 0.1 (13.01.2008)</p>
<ul>
<li>Первая версия. Выпущена с исходным кодом по лицензии GNU GPL</li>
</ul>
<p>Версия 0.2 (26.01.2008)</p>
<ul>
<li> четные размеры заплат вместо нечетных (с некоторыми соответствующими изменениями)</li>
<li> ассемблерная MMX оптимизация PatchTexture</li>
<li> используем SAD вместо SSD</li>
<li> обновление локольного максимального приоритета</li>
<li> опция оценивать радиус поиска автоматически</li>
<li> добавлен YUY2 формат (внутренний YUV24)</li>
<li> добавлено расширение маски</li>
</ul>

<p>Version 0.2.0 (16.09.2009, тот же бинарник)</p>
<li> исправлена документация</li>
<li> добавлена русская документация</li>

<p>Version 0.2.0.0 (15.09.2011, тот же бинарник)</p>
<li> исправлена документация по dilate</li>

<h3><a href="exinpaint01.zip">Download ExInpaint version 0.1</a></h3>
<h3><a href="exinpaint0200.zip">Download ExInpaint version 0.2.0.0</a></h3>

</body>
</html>